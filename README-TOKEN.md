# 带代币功能的私有区块链

本项目实现了一个具有代币发行功能的真实区块链系统，可以在本地建立私有链、创建创世区块并发行自定义代币。这个系统使用真实的密码学原语和区块链机制，支持代币转账和铸造等功能。

## 主要特点

- 完整的区块链实现，包含区块、交易和共识机制
- 自定义代币创建和管理
- 代币余额跟踪和转账功能
- 代币铸造（增发）功能
- 真实的工作量证明挖矿算法
- 密钥对生成及数字签名机制
- 持久化存储区块链数据
- 支持网络节点服务
- 命令行交互界面
- 易于部署和使用

## 系统要求

- Python 3.7+
- 标准库依赖（无需额外安装）

## 快速开始

### 创建并运行带代币功能的私有链节点

1. 在终端中运行以下命令启动一个区块链节点：

```bash
python real_blockchain.py --token_name "MyCoin" --token_symbol "MYC" --token_supply 10000000
```

2. 默认情况下，节点将在 `localhost:5000` 上运行
3. 节点启动后会自动创建创世区块和初始代币分配
4. 使用命令行界面与节点交互

### 代币相关命令

节点启动后，可以使用以下命令管理代币：

- `token_info` - 显示代币信息（名称、符号、总供应量等）
- `balance [地址]` - 查询指定地址（或当前节点）的代币余额
- `transfer <接收者地址> <金额>` - 从当前节点转移代币到指定地址
- `mint <接收者地址> <金额>` - 铸造新代币（仅限创建者）
- `all_balances` - 显示所有账户的代币余额

### 其他可用命令

- `add_block <数据>` - 添加新区块
- `show_chain` - 显示整个区块链
- `save` - 保存区块链到文件
- `load` - 从文件加载区块链
- `generate_keypair` - 生成新的密钥对
- `exit` - 退出节点

### 运行演示模式

如果您只想查看区块链和代币功能的演示，可以运行：

```bash
python real_blockchain.py --demo --token_name "MyCoin" --token_symbol "MYC"
```

演示模式将：
1. 创建一个新的区块链和创世区块
2. 初始化自定义代币
3. 创建一个新用户并转移部分代币
4. 显示代币余额和交易结果
5. 将区块链保存到文件

### 配置选项

通过命令行参数可以自定义区块链节点和代币：

```bash
python real_blockchain.py --host <主机地址> --port <端口号> --difficulty <挖矿难度> --token_name <代币名称> --token_symbol <代币符号> --token_supply <代币供应量>
```

- `--host` - 指定主机地址（默认：localhost）
- `--port` - 指定端口号（默认：5000）
- `--difficulty` - 设置挖矿难度（默认：4）
- `--token_name` - 设置代币名称（默认：MyToken）
- `--token_symbol` - 设置代币符号（默认：MTK）
- `--token_supply` - 设置代币初始供应量（默认：100,000,000,000）

## 代币系统详解

### 代币创建

代币在创世区块创建时自动初始化，初始供应量全部分配给区块链的创建者。代币具有以下属性：

- 名称（Name）：代币的全名，如 "Bitcoin"
- 符号（Symbol）：代币的简称，如 "BTC"
- 精度（Decimals）：代币的小数位数（默认18，与以太坊ERC20标准一致）
- 总供应量（Total Supply）：代币的初始总量

### 代币转账

任何持有代币的用户都可以将代币转移给其他用户。转账时需要：

1. 发送者的密钥对（用于签名交易）
2. 接收者的地址
3. 转账金额

系统会自动检查发送者是否有足够的余额，并在转账成功后生成一个新的区块记录这笔交易。

### 代币铸造

区块链的创建者可以铸造（增发）新的代币。铸造操作需要：

1. 创建者的密钥对（用于验证身份和签名）
2. 接收者的地址
3. 铸造金额

铸造成功后会增加代币的总供应量，并将新铸造的代币分配给指定的接收者。每次铸造操作也会生成一个新的区块记录这一操作。

## 技术细节

### 代币余额管理

系统使用一个地址到余额的映射（balances）来跟踪每个用户持有的代币数量。当发生转账时，系统会相应地更新发送者和接收者的余额。

### 交易验证

每笔代币交易都会经过以下验证：

1. 检查发送者是否拥有足够的余额
2. 验证交易签名是否来自发送者
3. 确保交易金额为正数

### 代币交易记录

所有代币相关的操作（转账、铸造等）都会记录在区块链上，每个操作都会创建一个新的区块。交易记录包含以下信息：

- 交易类型（转账、铸造等）
- 发送者地址
- 接收者地址
- 交易金额
- 时间戳
- 交易签名

## 多节点网络中的代币

要在多个节点组成的私有网络中使用代币功能：

1. 在不同的终端窗口中以相同的代币参数启动多个节点：
```bash
# 节点1
python real_blockchain.py --port 5000 --token_name "MyCoin" --token_symbol "MYC"

# 节点2
python real_blockchain.py --port 5001 --token_name "MyCoin" --token_symbol "MYC"
```

2. 节点之间可以通过网络通信同步区块链数据，保持代币余额的一致性

## 注意事项

- 此实现主要用于教育和演示目的
- 虽然使用了真实的加密技术，但仍建议不要用于存储敏感数据或高价值代币
- 生产环境中应考虑进一步增强安全性、可扩展性和功能完整性
- 当前实现中，代币余额是存储在内存中的，重启节点后需要从文件加载以恢复状态

## 常见问题解答

**Q: 如何更改代币的名称和符号？**  
A: 使用`--token_name`和`--token_symbol`参数启动节点。

**Q: 如何查看自己的代币余额？**  
A: 使用命令行中的`balance`命令（不带参数）查看当前节点的余额。

**Q: 如何转移代币给其他人？**  
A: 使用`transfer <接收者地址> <金额>`命令，如`transfer 1a2b3c4d5e 1000`。

**Q: 谁可以铸造（增发）新的代币？**  
A: 只有区块链创建者（创世区块中指定的地址）可以铸造新代币。

**Q: 转账和铸造操作是否需要支付费用？**  
A: 在当前实现中，代币操作不需要支付手续费。在实际的公链中通常需要支付手续费。

**Q: 如何备份我的代币和区块链数据？**  
A: 使用节点命令行中的`save`命令将区块链和代币数据保存到文件，默认保存为`blockchain.json`。 